doctype html
head
  meta(charset='utf-8')
  title &#xC9C0;&#xB3C4; &#xC0DD;&#xC131;&#xD558;&#xAE30;
// 지도를 표시할 div 입니다

style.
  .customoverlay {
    position:relative;
    margin-left: 25%;
    bottom:35px;
    border-radius:15px;
    border: 1px solid #ccc;
    border-bottom:2px solid #ddd;
    float:left;
    }
  .customoverlay:nth-of-type(n) {
    border:0;
    box-shadow:0px 1px 2px #888;
    }
  .customoverlay a {
    display:block;
    text-decoration:none;
    color:#000;
    text-align:center;
    border-radius:15px;
    font-size:5px;
    font-weight:bold;
    overflow:hidden;
    background: #f06292;
    background: #f06292  url(https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/arrow_white.png) no-repeat right 10px center;
    }
  .customoverlay .title {
    display:block;
    text-align:center;
    background:#f06292;
    margin-right:30px;
    padding:10px 15px;
    font-size:11px;
    font-weight:bold;
    color: white;
    }

    h1{
       //text-align: center;
       font-size:12px;
        font-weight:bold;
        color: white;
        margin: 7px 15px 20px auto;

    }
    	div {       text-align: center;
    		
    			 
    				height: 30px;
    				margin: -2px -1px auto;



    			}

#map(style='position: fixed;\
width: 100%;\
height: 100%;\
left: 0;\
top: 0;\
background: rgba(51,51,51,0.7);\
z-index: 10;')
script(type='text/javascript' src='//dapi.kakao.com/v2/maps/sdk.js?appkey=5a323567d193d1f90625406988f60389&libraries=services&libraries=services,clusterer,drawing')
script.
  
    var infowindow = new kakao.maps.InfoWindow({zIndex:1});
    var clickedOverlay = null;
      var data1 = "#{JSON.stringify(data)}"; //"#{data}".split(',');
     var data = JSON.parse(data1.replace(/&quot;/g,'"'));
     var markers = [];
     var distance;
        
     //flutter 화면과 통신
     function getResult(storename,address,phone,menu,bed,tableware,meetingroom,diapers,playroom,carriage,nursingroom,chair){
                 Print.postMessage(storename+','+address+','+phone+','+menu+','+bed+','+tableware+','+meetingroom+','+diapers+','+playroom+','+carriage+','+nursingroom+','+chair);}
     // 지도를 표시
     var mapContainer = document.getElementById('map'), 
                        mapOption = {
                        center: new kakao.maps.LatLng(#{lat}, #{long}), // 지도의 중심좌표
                        level: 5// 지도의 확대 레벨
                        };
     var map = new kakao.maps.Map(mapContainer, mapOption);
    var clusterer = new kakao.maps.MarkerClusterer({map: map, // 마커들을 클러스터로 관리하고 표시할 지도 객체
          averageCenter: true, // 클러스터에 포함된 마커들의 평균 위치를 클러스터 마커 위치로 설정
          minLevel: 5, // 클러스터 할 최소 지도 레벨
          calculator: [10, 30, 50], 
          disableClickZoom: true ,// 클러스터 마커를 클릭했을 때 지도가 확대되지 않도록 설정한다
          styles: [{ // calculator 각 사이 값 마다 적용될 스타일을 지정한다
                      width : '50px', height : '50px',
                  background:' #ff6e7f', /* fallback for old browsers */
                background: '-webkit-linear-gradient(to right,#ff6e7f, #f06292)',  /* Chrome 10-25, Safari 5.1-6 */
                background:' linear-gradient(to right, #ff6e7f, #f06292)', /* W3C, IE 10+/ Edge, Firefox 16+, Chrome 26+, Opera 12+, Safari 7+ */
                opacity: '0.7',
                borderRadius: '25px',
                color: 'white',
                textAlign: 'center',
                fontWeight: 'bold',
                lineHeight: '51px'

                 
                        },
                      
                        ]  });
    //marker 현재위치 이미지
     var imageSrc = 'http://hohoco.dothome.co.kr/img/path.gif',//'https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/marker_number_blue.png', // 마커이미지의 주소입니다
         imageSize = new kakao.maps.Size(34 , 34), // 마커이미지의 크기입니다
         imageOption = {offset: new kakao.maps.Point(13, 34)}; // 마커이미지의 옵션입니다. 마커의 좌표와 일치시킬 이미지 안에서의 좌표를 설정합니다.
     var markerImage = new kakao.maps.MarkerImage(imageSrc, imageSize, imageOption);
         
     var imageSrc1 ='http://hohoco.dothome.co.kr/img/marker.png'; // 마커이미지의 주소입니다
     var imageSize1 = new kakao.maps.Size(26, 34);
     var markerImage1 = new kakao.maps.MarkerImage(imageSrc1, imageSize1);
     var markerPosition = new kakao.maps.LatLng(#{lat}, #{long});
   //db 값 받아오기
    //-  var positions = [ ];
 	 
     console.log(data.length);
          //- for(let i=0; i<data.length; i+=14){
          //-         var allpositions = new Object();
          //-         allpositions.number = i;
          //-         allpositions.store_name = data[i];
          //-         allpositions.address = data[i+1];
          //-         allpositions.phone = data[i+2];
          //-         allpositions.menu = data[i+3];
          //-         allpositions.bed = data[i+4];
          //-         allpositions.tableware = data[i+5];
          //-         allpositions.meetingroom = data[i+6];
          //-         allpositions.diapers = data[i+7];
          //-         allpositions.playroom = data[i+8];
          //-         allpositions.carriage = data[i+9];
          //-         allpositions.nursingroom = data[i+10];
          //-         allpositions.chair = data[i+11];
          //-         allpositions.lat = data[i+12];
          //-         allpositions.lon = data[i+13];
          //-         positions.push(allpositions);
          //-         console.log(allpositions);  }
 
      // db에 저장된 마커 지도에 찍어주기(반복) 
      //- console.log(data);
      	data.forEach(function(v,i){
 						var coords = new kakao.maps.LatLng(data[i].lon,data[i].lat);
            var storename = "'"+ data[i].store_name+"'";
            var address =  "'"+ data[i].address+"'";
            var phone =  "'"+ data[i].phone+"'";
            var menu =  "'"+ data[i].menu+"'";
            var bed =  "'"+ data[i].bed+"'";
            var tableware =  "'"+ data[i].tableware+"'";
            var meetingroom =  "'"+ data[i].meetingroom+"'";
            var diapers =  "'"+ data[i].diapers+"'";
            var playroom =  "'"+ data[i].playroom+"'";
            var carriage =  "'"+ data[i].carriage+"'";
            var nursingroom =  "'"+ data[i].nursingroom+"'";
            var chair =  "'"+ data[i].chair+"'";
            // 마커 찍어주는 함수 호출
           distance = calcDist(#{lat},#{long},data[i].lon,data[i].lat);
           if(distance<500){
            displayMarker(coords,data[i].store_name,storename,address,phone,menu,bed,tableware,meetingroom,diapers,playroom,carriage,nursingroom,chair);
           }    
             
         	});
            clusterer.addMarkers(markers);
          //-  console.log(data);
                                            // 현재 위치 표시
 				 var marker = new kakao.maps.Marker({
                                    position: markerPosition,
                                    image: markerImage,
                                    });
             marker.setMap(map);
       // 마커 찍어주는 함수
 				function displayMarker(coords,store_name,storename,address,phone,menu,bed,tableware,meetingroom,diapers,playroom,carriage,nursingroom,chair) {
               // 마커를 생성하고 지도에 표시합니다
            var marker = new kakao.maps.Marker({
                                                 map: map,
                                                 position: coords,
                                                 image : markerImage1,
                                             });
          markers.push(marker);
     var content =  '<div style="padding: 3px 28px 3px 15px; \
                 		border-radius:20px;\
                    box-shadow:0px 3px 2px #888;\
                    background-color:#f06292;  \
                    background: #f06292  url(http://hohoco.dothome.co.kr/img/arrow.png) no-repeat right 4px center; ;\
                    background-size: 28px 28px\
                   "onclick="getResult('+storename+','+address+','+phone+','+menu+','+bed+','+tableware+','+meetingroom+','+diapers+','+playroom+','+carriage+','+nursingroom+','+chair+')">'+
                    '<h1>'  +store_name +'</h1>'+ '</div>';
       
              var CustomOverlay  = new kakao.maps.CustomOverlay({
                  position: coords,
                  content: content,  
                   yAnchor:2.4 ,
                   clickable :true
              });

            kakao.maps.event.addListener(marker, 'click', function() { 
             if (clickedOverlay!=null) {
                clickedOverlay.setMap(null);}
                CustomOverlay.setMap(map);
                clickedOverlay = CustomOverlay;
            

          });
          kakao.maps.event.addListener(map, 'click', function(mouseEvent) {        
           if(CustomOverlay!=null){
              CustomOverlay.setMap(null);     
           }
    
            });
         };  
                kakao.maps.event.addListener(clusterer, 'clusterclick', function(cluster) {

              // 현재 지도 레벨에서 1레벨 확대한 레벨
              var level = map.getLevel()-1;

              // 지도를 클릭된 클러스터의 마커의 위치를 기준으로 확대합니다
              map.setLevel(level, {anchor: cluster.getCenter()});
          });
         function calcDist(lat1,lng1,lat2,lng2) {
            var ret = 0;
            var latA = 111;
            var lngB = 88.8;
            ret = Math.sqrt(
                    Math.pow((Math.abs(lat1 - lat2) * latA),2)
                    +
                    Math.pow((Math.abs(lng1 - lng2) * lngB),2)
                  ) *1000;//m
            return ret.toFixed(2);
          }    
  